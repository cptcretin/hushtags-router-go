(self.webpackChunkhushtags_app=self.webpackChunkhushtags_app||[]).push([[9980],{9980:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ViewPageModule:()=>B});var n=i(8583),o=i(3679),a=i(3083),s=i(1210),r=i(5642),l=i(8069),g=i(4762),c=i(4402),d=i(9193),h=i(8891),p=i(3190),m=i(9773),u=i(5304),f=i(8002),v=i(7716),_=i(6279),Z=i(9675),x=i(6598),b=i(5353),w=i(639),k=i(8971),O=i(5887),A=i(8252),C=i(2235),M=i(1363);function P(t,e){if(1&t&&(w.TgZ(0,"div",13),w._UZ(1,"img",14),w._UZ(2,"div",15),w.qZA()),2&t){const t=w.oxw();w.xp6(1),w.Q6J("src",t.cover,w.LSH)}}function H(t,e){if(1&t&&w._UZ(0,"img",22),2&t){const t=w.oxw().$implicit;w.Q6J("src",t.icon,w.LSH)}}function T(t,e){if(1&t){const t=w.EpF();w.TgZ(0,"ion-col",16),w.TgZ(1,"ion-card",17),w.NdJ("click",function(){const e=w.CHM(t).$implicit;return w.oxw().open(e)}),w.TgZ(2,"ion-card-content"),w.TgZ(3,"div",18),w._UZ(4,"img",19),w.YNc(5,H,1,1,"img",20),w._UZ(6,"div",21),w.qZA(),w.TgZ(7,"ion-card-title"),w._uU(8),w.qZA(),w._uU(9),w.qZA(),w.qZA(),w.qZA()}if(2&t){const t=e.$implicit;w.xp6(4),w.Q6J("src",t.cover,w.LSH),w.xp6(1),w.Q6J("ngIf",t.isContent),w.xp6(3),w.Oqu(t.title),w.xp6(1),w.hij(" ",t.description," ")}}function q(t,e){if(1&t&&(w.TgZ(0,"ion-avatar"),w._UZ(1,"img",25),w.qZA()),2&t){const t=w.oxw(2);w.xp6(1),w.Q6J("src",t.avatar,w.LSH)}}function y(t,e){if(1&t&&(w.TgZ(0,"div",23),w.TgZ(1,"ion-chip"),w.YNc(2,q,2,1,"ion-avatar",24),w.TgZ(3,"ion-label"),w._uU(4),w.qZA(),w.qZA(),w.TgZ(5,"div"),w._uU(6),w.qZA(),w.qZA()),2&t){const t=w.oxw();w.xp6(2),w.Q6J("ngIf",t.avatar),w.xp6(2),w.Oqu(t.author),w.xp6(2),w.Oqu(t.message)}}function $(t,e){if(1&t){const t=w.EpF();w.TgZ(0,"ion-button",11),w.NdJ("click",function(){return w.CHM(t),w.oxw().create()}),w._UZ(1,"ion-icon",26),w.qZA()}}let I=(()=>{class t{constructor(t,e,i,n,o,a,s,r,l){this.route=t,this.alert=e,this.api=i,this.log=n,this.ga=o,this.modal=a,this.nav=s,this.settings=r,this.translations=l,this.backHref="/",this.translations.ready([F.Alert_Flag_Title,F.Alert_Flag_Message,F.Alert_Flagged_Title,F.Alert_Flagged_Message,F.Button_Yes,F.Button_No,F.Button_OK]).then()}ngOnInit(){let t=this.route.snapshot.paramMap;this.tagHandle=t.get("tag"),this.arkHandle=t.get("archive")}ionViewWillEnter(){let t=this.settings.get(Z.n7.ignore);t&&t.tag&&t.tag.indexOf(this.tagHandle)>=0||!this.tagHandle||0==this.tagHandle.length?this.nav.navigate(["/"]):(this.ga.pageView(this.nav.url),this.arkHandle&&0!=this.arkHandle.length?this.loadContent():this.loadArchives())}open(t){return(0,g.mG)(this,void 0,void 0,function*(){let e=/(audio|video|image)/.test(t.mime);if(t.isContent)if(e){let e=yield this.modal.create({cssClass:"dialog-media",component:b.R,componentProps:{uri:this.api.url(`/ark/${this.tagHandle}/${this.arkHandle}/${t.fileName}`),mime:t.mime,title:t.title}});yield e.present()}else window.open(this.api.url(`/ark/${this.tagHandle}/${this.arkHandle}/${t.fileName}`),"_blank");else this.nav.navigate([`view/${this.tagHandle}/${t.handle}`])})}create(){return(0,g.mG)(this,void 0,void 0,function*(){let t=yield this.modal.create({cssClass:x.e,component:x.l});yield t.present()})}flag(){return(0,g.mG)(this,void 0,void 0,function*(){let t=yield this.alert.create({header:this.translations.get(F.Alert_Flag_Title),message:this.translations.get(F.Alert_Flag_Message),buttons:[{text:this.translations.get(F.Button_Yes),handler:()=>(0,g.mG)(this,void 0,void 0,function*(){return yield this.removeItem()})},{text:this.translations.get(F.Button_No),role:"cancel"}]});yield t.present()})}loadArchives(){let t=this.settings.get(Z.n7.ignore);this.api.get(`/tag/${this.tagHandle}`).pipe((0,p.w)(e=>(0,c.D)(e.contents.filter(e=>!t||!t.ark||-1===t.ark.indexOf(e.handle)))),(0,m.VS)(t=>this.api.get(`/ark/${this.tagHandle}/${t.handle}`).pipe((0,u.K)(()=>d.E)),t=>t),(0,f.U)(t=>({handle:t.handle,cover:_.Lb,isContent:!1,title:t.title,description:t.description})),(0,v.q)()).subscribe(t=>{t.forEach(t=>this.coverImage(t).subscribe(e=>t.cover=e)),this.items=t,this.locked=!1})}loadContent(){this.api.get(`/tag/${this.tagHandle}/${this.arkHandle}`).subscribe(t=>{this.title=t.title,this.message=t.description,this.showMessage=!0,this.cover=_.Lb,this.coverImage({handle:t.handle,isContent:!1}).subscribe(t=>this.cover=t)}),this.api.get(`/ark/${this.tagHandle}/${this.arkHandle}`).subscribe(t=>{let e=t.manifest.items.map(t=>({handle:this.arkHandle,cover:_.Lb,icon:this.iconImage(t.mime),isContent:!0,title:t.title,description:t.description,fileName:t.fileName,mime:t.mime,default:t.default}));e.forEach(t=>this.coverImage(t).subscribe(e=>t.cover=e)),this.items=e;let i=this.items.find(t=>t.default);i&&this.open(i),t.author?(this.author=t.author.handle,this.avatar=t.author.avatar?`data:image/png;base64,${t.author.avatar}`:_.aI,this.hasAuthor=!0):(this.author="Anonymous",this.avatar=_.aI)}),this.api.get(`/tag/${this.tagHandle}`).subscribe(t=>{this.locked=t.locked,t.contents.length>1&&(this.backHref=`/view/${this.tagHandle}`)})}removeItem(){return(0,g.mG)(this,void 0,void 0,function*(){let t=this.arkHandle&&this.arkHandle.length>0,e=this.settings.get(Z.n7.ignore);e||(e={tag:[],ark:[]}),t?e.ark.push(this.arkHandle):e.tag.push(this.tagHandle),this.log.trace("ignoring",e),this.settings.set(Z.n7.ignore,{value:e});let i=yield this.alert.create({header:this.translations.get(F.Alert_Flagged_Title),message:this.translations.get(F.Alert_Flagged_Message),buttons:[{text:this.translations.get(F.Button_OK)}]});i.onDidDismiss().then(()=>this.nav.navigate([this.backHref])),yield i.present()})}coverImage(t){return h.y.create(e=>{if(t.isContent){let i="";t.mime.indexOf("image")>=0?i=this.api.url(`/ark/${this.tagHandle}/${this.arkHandle}/${t.fileName}`):t.mime.indexOf("text")>=0||t.mime.indexOf("pdf")>=0?i="/assets/img/content/pen.png":t.mime.indexOf("audio")>=0?i="/assets/img/content/audio.png":t.mime.indexOf("video")>=0&&("video/youtube"===t.mime&&(i=`http://img.youtube.com/vi/${t.fileName.split("/").pop().split(".").shift()}/mqdefault.jpg`),i="/assets/img/content/video.png"),e.next(i),e.complete()}else{let i=new Image,n=this.api.url(`/ark/${this.tagHandle}/${t.handle}/_cover`);t.cover=_.Lb,i.onload=()=>{e.next(n),e.complete()},i.onerror=()=>{e.next(_.Lb),e.complete()},i.src=n}})}iconImage(t){return t.indexOf("image")>=0?"/assets/img/overlay/image.png":t.indexOf("audio")>=0?"/assets/img/overlay/audio.png":t.indexOf("video")>=0?"/assets/img/overlay/video.png":t.indexOf("pdf")>=0?"/assets/img/overlay/pdf.png":"/assets/img/overlay/document.png"}}return t.\u0275fac=function(e){return new(e||t)(w.Y36(l.gz),w.Y36(a.Br),w.Y36(s.fL),w.Y36(k.h),w.Y36(O.$),w.Y36(a.IN),w.Y36(l.F0),w.Y36(Z.Xy),w.Y36(A.ZT))},t.\u0275cmp=w.Xpm({type:t,selectors:[["app-view"]],decls:23,vars:7,consts:[["lines","none"],["color","dark","fill","clear","slot","start",3,"href"],["slot","icon-only","name","arrow-back-outline"],[3,"fullscreen"],["class","section-cover",4,"ngIf"],[1,"section-content-list"],["size-sm","12","size-md","6","size-lg","4",4,"ngFor","ngForOf"],["class","section-message",4,"ngIf"],["slot","start"],["fill","clear","color","dark",3,"click",4,"ngIf"],["slot","end"],["fill","clear","color","dark",3,"click"],["name","alert"],[1,"section-cover"],[1,"image-cover",3,"src"],[1,"shadow"],["size-sm","12","size-md","6","size-lg","4"],[3,"click"],[1,"contentPreview"],[1,"preview",3,"src"],["class","overlay",3,"src",4,"ngIf"],[1,"mask"],[1,"overlay",3,"src"],[1,"section-message"],[4,"ngIf"],[3,"src"],["name","add-outline"]],template:function(t,e){1&t&&(w.TgZ(0,"ion-header"),w._UZ(1,"app-header"),w.qZA(),w.TgZ(2,"ion-toolbar"),w.TgZ(3,"ion-item",0),w.TgZ(4,"ion-button",1),w._UZ(5,"ion-icon",2),w.qZA(),w.TgZ(6,"ion-title"),w._uU(7),w.qZA(),w.qZA(),w.qZA(),w.TgZ(8,"ion-content",3),w.YNc(9,P,3,1,"div",4),w.TgZ(10,"div",5),w.TgZ(11,"ion-grid"),w.TgZ(12,"ion-row"),w.YNc(13,T,10,4,"ion-col",6),w.qZA(),w.qZA(),w.qZA(),w.YNc(14,y,7,3,"div",7),w.qZA(),w.TgZ(15,"ion-footer"),w.TgZ(16,"ion-toolbar"),w.TgZ(17,"ion-buttons",8),w.YNc(18,$,2,0,"ion-button",9),w.qZA(),w.TgZ(19,"ion-buttons",10),w.TgZ(20,"ion-button",11),w.NdJ("click",function(){return e.flag()}),w._UZ(21,"ion-icon",12),w.qZA(),w.qZA(),w.qZA(),w._UZ(22,"app-footer"),w.qZA()),2&t&&(w.xp6(4),w.Q6J("href",e.backHref),w.xp6(3),w.Oqu(e.title),w.xp6(1),w.Q6J("fullscreen",!0),w.xp6(1),w.Q6J("ngIf",e.showMessage),w.xp6(4),w.Q6J("ngForOf",e.items),w.xp6(1),w.Q6J("ngIf",e.showMessage),w.xp6(4),w.Q6J("ngIf",!e.locked))},directives:[a.Gu,C.P,a.sr,a.Ie,a.YG,a.gu,a.wd,a.W2,n.O5,a.jY,a.Nd,n.sg,a.fr,a.Sm,M.q,a.wI,a.PM,a.FN,a.gZ,a.hM,a.Q$,a.BJ],styles:[".section-cover[_ngcontent-%COMP%]{position:fixed;width:100vw;height:100vh;left:0;z-index:-1}.section-cover[_ngcontent-%COMP%]   .image-cover[_ngcontent-%COMP%]{width:100vw;height:100vh;object-fit:cover}.section-cover[_ngcontent-%COMP%]   .shadow[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100vw;height:100vh;background:#000;opacity:.7}ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{padding-inline:0;text-align:left}.section-content-list[_ngcontent-%COMP%]{position:relative;left:0;right:0;margin:0 auto;max-width:900px}.section-message[_ngcontent-%COMP%]{position:fixed;bottom:120px;left:10px;padding:5px;background:var(--ion-color-light);border:1px solid var(--ion-color-light);border-radius:5px}.mask[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;background-color:#000;opacity:.4;z-index:-1}.coverPhoto[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;margin:0 auto;max-width:200%}.description[_ngcontent-%COMP%]{font-size:medium;margin:20px 0;padding:8px}ion-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   .contentPreview[_ngcontent-%COMP%]{position:relative;min-height:180px;min-width:180px}ion-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   .contentPreview[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;object-fit:cover}ion-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   .contentPreview[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;top:47px;left:50%;margin-left:-45px;width:95px;z-index:3}ion-grid[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   .contentPreview[_ngcontent-%COMP%]   .mask[_ngcontent-%COMP%]{z-index:2}"]}),t})();const F={Alert_Flag_Title:"Page_View.Alert_Flag_Title",Alert_Flag_Message:"Page_View.Alert_Flag_Message",Alert_Flagged_Title:"Page_View.Alert_Flagged_Title",Alert_Flagged_Message:"Page_View.Alert_Flagged_Message",Button_Yes:"Common.Button_Yes",Button_No:"Common.Button_No",Button_OK:"Common.Button_OK"},N=[{path:"",component:I},{path:":tag",component:I},{path:":tag/:archive",component:I}];let Y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({imports:[[l.Bz.forChild(N)],l.Bz]}),t})(),B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=w.oAB({type:t}),t.\u0275inj=w.cJS({providers:[s.fL],imports:[[n.ez,r.K,o.u5,a.Pc,Y]]}),t})()}}]);