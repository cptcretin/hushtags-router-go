{"version":3,"sources":["./src/app/discover/discover-routing.module.ts","./src/app/discover/discover.module.ts","./src/app/discover/discover.page.ts","./src/app/discover/discover.page.scss","./src/app/discover/discover.page.html"],"names":[],"mappings":"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","file":"src_app_discover_discover_module_ts.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { DiscoverPage } from './discover.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: DiscoverPage\n  },\n  {\n    path: ':tag',\n    component: DiscoverPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class DiscoverPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ApiClientModule } from '../include/api-client/api-client.module';\nimport { Translations } from '../include/i18n/i18n.module';\n\nimport { ComponentsModule } from '../components/components.module';\n\nimport { DiscoverPageRoutingModule } from './discover-routing.module';\n\nimport { DiscoverPage } from './discover.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ComponentsModule,\n    FormsModule,\n    IonicModule,\n    Translations,\n    DiscoverPageRoutingModule\n  ],\n  providers: [\n    ApiClientModule,\n  ],\n  declarations: [DiscoverPage]\n})\nexport class DiscoverPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { EMPTY, from } from 'rxjs';\nimport { catchError, concatMap, first } from 'rxjs/operators';\n\nimport { ApiClientModule, ApiRequest, TagModel, TagStatus } from '../include/api-client/api-client.module';\nimport { AppLogService } from '../include/app-log/app-log.service';\nimport { DefaultCoverPhoto } from '../include/app-settings/app-settings.module';\nimport { LocationService } from '../include/location/location.service';\nimport { Translations } from '../include/i18n/i18n.module';\n\n@Component({\n  selector: 'app-discover',\n  templateUrl: './discover.page.html',\n  styleUrls: ['./discover.page.scss'],\n})\nexport class DiscoverPage implements OnInit {\n\n    constructor(\n        private route: ActivatedRoute,\n        private api: ApiClientModule,\n        private log: AppLogService,\n        private gps: LocationService,\n        private translate: Translations,\n    ) { }\n    \n    isAvailable: boolean;\n    title: string;\n    coverPhoto: string = DefaultCoverPhoto;\n    \n    tagHandle: string\n    arkHandle: string\n\n    async ngOnInit() {\n\t\tlet tag = this.route.snapshot.paramMap.get('tag');\n\t\t\n\t\tif (tag && tag.length > 0) {\n\t\t    await this.readTag(tag);\n\t\t}\n    }\n    \n    private async readTag(tagHandle: string) {\n        let pos = undefined;\n\n        try {\n            pos = await this.gps.getLocation();\n        } catch {}\n\n        let point = pos ? `${pos.lat},${pos.lon}` : '';\n        let req = new ApiRequest(`/tag/${tagHandle}`)\n            .addHeaders([ { name: 'x-hushtags-tapLocation', value: point } ]);\n\n        this.api.get<TagModel>(req)\n            .subscribe( res => {\n                this.title = res.title;\n                this.tagHandle = tagHandle;\n                this.arkHandle = res.contents.length == 1 ? res.contents[0].handle : '';\n                this.isAvailable = res.status == TagStatus.Unassigned;\n\n                from(res.contents)\n                    .pipe(\n                        concatMap( ark =>\n                            this.api.get(new ApiRequest(`/ark/${tagHandle}/${ark.handle}`)).pipe( catchError( () => EMPTY ) )\n                        , ark => ark ),\n                        first()\n                    )\n                    .subscribe(\n                        ark => {\n                            let img = new Image();\n                            let coverPhoto = this.api.url(`/ark/${tagHandle}/${ark.handle}/_cover`);\n\n                            img.onload = () => this.coverPhoto = coverPhoto;\n                            img.src = coverPhoto;\n                        },\n\n                        err => {\n                            this.log.ex(\"got error\", err);\n                        }\n                    );\n            });\n    }\n}\n","export default \".section-cover {\\n  position: fixed;\\n  width: 100vw;\\n  height: 100vh;\\n  left: 0;\\n  z-index: -1;\\n}\\n.section-cover .image-cover {\\n  width: 100vw;\\n  height: 100vh;\\n  object-fit: cover;\\n}\\n.section-cover .shadow {\\n  position: absolute;\\n  top: 0px;\\n  left: 0px;\\n  width: 100vw;\\n  height: 100vh;\\n  background: #000;\\n  opacity: 0.7;\\n}\\n.prompt-show-content {\\n  position: fixed;\\n  top: 0px;\\n  bottom: 0px;\\n  left: 0px;\\n  right: 0px;\\n  height: min-content;\\n  width: min-content;\\n  margin: auto;\\n}\\n.prompt-show-content .learn-more {\\n  --background: var(--ion-color-light);\\n}\\n.prompt-show-content .learn-more ion-button {\\n  text-transform: none;\\n}\\n.text-title h1 {\\n  font-size: 1.15em;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpc2NvdmVyLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLGVBQUE7RUFDQSxZQUFBO0VBQ0EsYUFBQTtFQUNBLE9BQUE7RUFDQSxXQUFBO0FBQ0o7QUFDSTtFQUNJLFlBQUE7RUFDQSxhQUFBO0VBQ0EsaUJBQUE7QUFDUjtBQUVJO0VBQ0ksa0JBQUE7RUFDQSxRQUFBO0VBQ0EsU0FBQTtFQUNBLFlBQUE7RUFDQSxhQUFBO0VBQ0EsZ0JBQUE7RUFDQSxZQUFBO0FBQVI7QUFJQTtFQUNJLGVBQUE7RUFDQSxRQUFBO0VBQ0EsV0FBQTtFQUNBLFNBQUE7RUFDQSxVQUFBO0VBQ0EsbUJBQUE7RUFDQSxrQkFBQTtFQUNBLFlBQUE7QUFESjtBQUdJO0VBQ0ksb0NBQUE7QUFEUjtBQUdRO0VBQ0ksb0JBQUE7QUFEWjtBQU9JO0VBQ0ksaUJBQUE7QUFKUiIsImZpbGUiOiJkaXNjb3Zlci5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuc2VjdGlvbi1jb3ZlciB7XG4gICAgcG9zaXRpb246IGZpeGVkO1xuICAgIHdpZHRoOiAxMDB2dztcbiAgICBoZWlnaHQ6IDEwMHZoO1xuICAgIGxlZnQ6IDA7XG4gICAgei1pbmRleDogLTE7XG5cbiAgICAuaW1hZ2UtY292ZXIge1xuICAgICAgICB3aWR0aDogMTAwdnc7XG4gICAgICAgIGhlaWdodDogMTAwdmg7XG4gICAgICAgIG9iamVjdC1maXQ6IGNvdmVyO1xuICAgIH1cbiAgICBcbiAgICAuc2hhZG93IHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICB0b3A6IDBweDtcbiAgICAgICAgbGVmdDogMHB4O1xuICAgICAgICB3aWR0aDogMTAwdnc7XG4gICAgICAgIGhlaWdodDogMTAwdmg7XG4gICAgICAgIGJhY2tncm91bmQ6ICMwMDA7XG4gICAgICAgIG9wYWNpdHk6IDAuNztcbiAgICB9XG59XG5cbi5wcm9tcHQtc2hvdy1jb250ZW50IHtcbiAgICBwb3NpdGlvbjogZml4ZWQ7XG4gICAgdG9wOiAwcHg7XG4gICAgYm90dG9tOiAwcHg7XG4gICAgbGVmdDogMHB4O1xuICAgIHJpZ2h0OiAwcHg7XG4gICAgaGVpZ2h0OiBtaW4tY29udGVudDtcbiAgICB3aWR0aDogbWluLWNvbnRlbnQ7XG4gICAgbWFyZ2luOiBhdXRvO1xuXG4gICAgLmxlYXJuLW1vcmUge1xuICAgICAgICAtLWJhY2tncm91bmQ6IHZhcigtLWlvbi1jb2xvci1saWdodCk7XG5cbiAgICAgICAgaW9uLWJ1dHRvbiB7XG4gICAgICAgICAgICB0ZXh0LXRyYW5zZm9ybTogbm9uZTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLnRleHQtdGl0bGUge1xuICAgIGgxIHtcbiAgICAgICAgZm9udC1zaXplOiAxLjE1ZW07XG4gICAgfVxufVxuIl19 */\";","export default \"<ion-header>\\n    <app-header></app-header>\\n</ion-header>\\n\\n<ion-content [fullscreen]=\\\"true\\\">\\n    <div class=\\\"section-cover\\\">\\n        <img [src]=\\\"coverPhoto\\\" class=\\\"image-cover\\\" />\\n        <div class=\\\"shadow\\\"></div>\\n    </div>\\n    \\n    <ion-card class=\\\"prompt-show-content\\\">\\n        <ion-card-header>\\n            <ion-card-title>{{ title }}</ion-card-title>\\n        </ion-card-header>\\n        \\n        <ion-card-content>{{ 'Page_Discover.Tag_Found' | translate }}</ion-card-content>\\n\\n        <ion-item lines=\\\"none\\\">\\n            <ion-button [href]=\\\"'/view/'+tagHandle+'/'+arkHandle\\\" class=\\\"ion-margin\\\" expand=\\\"block\\\" size=\\\"large\\\" color=\\\"primary\\\" slot=\\\"start\\\">{{ 'Common.Button_Casual_Confirm' | translate }}</ion-button>\\n            <ion-button href=\\\"/\\\" class=\\\"ion-margin\\\" expand=\\\"block\\\" size=\\\"large\\\" fill=\\\"clear\\\" slot=\\\"end\\\">{{ 'Common.Button_Casual_Deny' | translate }}</ion-button>\\n        </ion-item>\\n\\n    <ion-item lines=\\\"none\\\" class=\\\"learn-more\\\">\\n            <ion-button href=\\\"/about\\\" fill=\\\"clear\\\" color=\\\"primary\\\" slot=\\\"end\\\">{{ 'Page_Discover.Learn_More' | translate }}</ion-button>\\n        </ion-item>\\n    </ion-card>\\n</ion-content>\\n\\n<ion-footer>\\n    <app-footer></app-footer>\\n</ion-footer>\\n\";"],"sourceRoot":"webpack:///"}