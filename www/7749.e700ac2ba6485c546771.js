(self.webpackChunkhushtags_app=self.webpackChunkhushtags_app||[]).push([[7749],{7749:(t,e,n)=>{"use strict";n.r(e),n.d(e,{DiscoverPageModule:()=>y});var o=n(8583),i=n(3679),s=n(3083),a=n(1210),r=n(8252),c=n(5642),l=n(8069),h=n(4762),g=n(4402),d=n(9193),p=n(4612),u=n(5304),m=n(8049),v=n(6279),f=n(6598),Z=n(1879),_=n(639),C=n(8971),w=n(5887),P=n(7927),x=n(2235),b=n(1363),O=n(1514);function q(t,e){if(1&t&&(_.TgZ(0,"ion-card",5),_.TgZ(1,"ion-card-header"),_.TgZ(2,"ion-card-title"),_._uU(3),_.qZA(),_.qZA(),_.TgZ(4,"ion-card-content"),_._uU(5),_.ALo(6,"translate"),_.qZA(),_.TgZ(7,"ion-item",6),_.TgZ(8,"ion-button",7),_._uU(9),_.ALo(10,"translate"),_.qZA(),_.TgZ(11,"ion-button",8),_._uU(12),_.ALo(13,"translate"),_.qZA(),_.qZA(),_.TgZ(14,"ion-item",9),_.TgZ(15,"ion-button",10),_._uU(16),_.ALo(17,"translate"),_.qZA(),_.qZA(),_.qZA()),2&t){const t=_.oxw();_.xp6(3),_.Oqu(t.title),_.xp6(2),_.Oqu(_.lcZ(6,6,"Page_Discover.Tag_Found")),_.xp6(3),_.Q6J("href","/view/"+t.tagHandle+"/"+t.arkHandle),_.xp6(1),_.Oqu(_.lcZ(10,8,"Common.Button_Casual_Confirm")),_.xp6(3),_.Oqu(_.lcZ(13,10,"Common.Button_Casual_Deny")),_.xp6(4),_.Oqu(_.lcZ(17,12,"Page_Discover.Learn_More"))}}let A=(()=>{class t{constructor(t,e,n,o,i,s,a,r){this.route=t,this.api=e,this.log=n,this.ga=o,this.gps=i,this.dialog=s,this.nav=a,this.translate=r,this.coverPhoto=v.Lb}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){this.tagHandle=this.route.snapshot.paramMap.get("tag")})}ionViewWillEnter(){return(0,h.mG)(this,void 0,void 0,function*(){this.tagHandle&&this.tagHandle.length>0?(yield this.readTag(),this.ga.pageView(this.nav.url)):this.nav.navigate(["/"])})}readTag(){return(0,h.mG)(this,void 0,void 0,function*(){let t;try{t=yield this.gps.getLocation()}catch(o){}let e=t?`${t.lat},${t.lon}`:"",n=new a.xm(`/tag/${this.tagHandle}`).addHeaders([{name:"x-hushtags-tapLocation",value:e}]);this.api.get(n).subscribe(t=>(0,h.mG)(this,void 0,void 0,function*(){if(this.title=t.title,this.arkHandle=1==t.contents.length?t.contents[0].handle:"",this.hasContent=t.contents.length>0,t.status===a.Mo.Unassigned){let t=yield this.dialog.create({component:f.l,cssClass:f.e});t.onDidDismiss().then(()=>this.nav.navigate(["/"])),yield t.present()}else if(!this.hasContent){let t=yield this.dialog.create({component:Z.E,cssClass:Z.e});t.onDidDismiss().then(()=>this.nav.navigate(["/"])),yield t.present()}this.fetchCover(t.contents)}),t=>(0,h.mG)(this,void 0,void 0,function*(){this.log.ex("error fetching tag",t);let e=yield this.dialog.create({component:Z.E,cssClass:Z.e});e.onDidDismiss().then(()=>this.nav.navigate(["/"])),yield e.present()}))})}fetchCover(t){(0,g.D)(t).pipe((0,p.b)(t=>this.api.get(new a.xm(`/ark/${this.tagHandle}/${t.handle}`)).pipe((0,u.K)(()=>d.E)),t=>t),(0,m.P)()).subscribe(t=>{let e=new Image,n=this.api.url(`/ark/${this.tagHandle}/${t.handle}/_cover`);e.onload=()=>this.coverPhoto=n,e.src=n},t=>{this.log.ex("got error",t)})}}return t.\u0275fac=function(e){return new(e||t)(_.Y36(l.gz),_.Y36(a.fL),_.Y36(C.h),_.Y36(w.$),_.Y36(P.a),_.Y36(s.IN),_.Y36(l.F0),_.Y36(r.ZT))},t.\u0275cmp=_.Xpm({type:t,selectors:[["app-discover"]],decls:9,vars:3,consts:[[3,"fullscreen"],[1,"section-cover"],[1,"image-cover",3,"src"],[1,"shadow"],["class","prompt-show-content",4,"ngIf"],[1,"prompt-show-content"],["lines","none"],["expand","block","size","large","color","primary","slot","start",1,"ion-margin",3,"href"],["href","/","expand","block","size","large","fill","clear","slot","end",1,"ion-margin"],["lines","none",1,"learn-more"],["href","/about","fill","clear","color","primary","slot","end"]],template:function(t,e){1&t&&(_.TgZ(0,"ion-header"),_._UZ(1,"app-header"),_.qZA(),_.TgZ(2,"ion-content",0),_.TgZ(3,"div",1),_._UZ(4,"img",2),_._UZ(5,"div",3),_.qZA(),_.YNc(6,q,18,14,"ion-card",4),_.qZA(),_.TgZ(7,"ion-footer"),_._UZ(8,"app-footer"),_.qZA()),2&t&&(_.xp6(2),_.Q6J("fullscreen",!0),_.xp6(2),_.Q6J("src",e.coverPhoto,_.LSH),_.xp6(2),_.Q6J("ngIf",e.hasContent))},directives:[s.Gu,x.P,s.W2,o.O5,s.fr,b.q,s.PM,s.Zi,s.gZ,s.FN,s.Ie,s.YG],pipes:[O.X$],styles:[".section-cover[_ngcontent-%COMP%]{position:fixed;width:100vw;height:100vh;left:0;z-index:-1}.section-cover[_ngcontent-%COMP%]   .image-cover[_ngcontent-%COMP%]{width:100vw;height:100vh;object-fit:cover}.section-cover[_ngcontent-%COMP%]   .shadow[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100vw;height:100vh;background:#000;opacity:.7}.prompt-show-content[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;right:0;height:min-content;width:min-content;margin:auto}.prompt-show-content[_ngcontent-%COMP%]   .learn-more[_ngcontent-%COMP%]{--background:var(--ion-color-light)}.prompt-show-content[_ngcontent-%COMP%]   .learn-more[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{text-transform:none}.text-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.15em}"]}),t})();const M=[{path:"",component:A},{path:":tag",component:A}];let T=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=_.oAB({type:t}),t.\u0275inj=_.cJS({imports:[[l.Bz.forChild(M)],l.Bz]}),t})(),y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=_.oAB({type:t}),t.\u0275inj=_.cJS({providers:[a.fL],imports:[[o.ez,c.K,i.u5,s.Pc,r.ZT,T]]}),t})()}}]);